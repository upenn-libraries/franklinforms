<section id="item-details">
  <h2><%= t('forms.local_request.sections.record') %></h2>
  <div class="row">
    <div class="col-sm-6">
      <%= form.static_control :title, label: t('forms.local_request.fields.title') do %>
        <%= @record.bib_data['title'] %>
      <% end %>
    </div>
    <div class="col-sm-6">
      <%= form.static_control :author, label: t('forms.local_request.fields.author') do %>
        <%= @record.bib_data['author'] %>
      <% end %>
    </div>
  </div>
  <% if @record.one_item? %>
    <%= form.hidden_field :holding_id, value: @record.holdings.first.id %>
    <%= form.hidden_field :item_pid, value: @record.items.first.pid %>
    <% if @record.items.first.checkoutable? %>
      <div class="alert alert-success">
        Item is [in place and not non-circulating, not ETAS restricted and loanable] available for PickUp or Books by Mail Delivery
      </div>
    <% else %>
      <div class="alert alert-warning">
        <%= t('forms.local_request.messages.unavailable_html', ill_link: '#') %>
      </div>
    <% end %>
  <% elsif @record.items&.any? %>
    <div class="alert alert-info">
      <%= t('forms.local_request.messages.item_prompt') %>
    </div>
    <%= form.form_group :item, label: { text: "Item" } do %>
      <% @record.items.each do |item| %>
        <%= form.radio_button :item_pid, item.pid, { label: item.label_for_radio_button, class: 'item-select-radio', data: { delivery: item.delivery_options.join(':') } } %>
      <% end %>
    <% end %>
  <% else %>
    <div class="panel-group" id="holding-accordion" role="tablist" aria-multiselectable="true">
      <% if @record.holdings.any? %>
        <% @record.holdings.each_with_index do |holding, i| %>
          <% if holding.available? %>
            <div class="hidden">
              <%= form.radio_button :holding_id, holding.id, class: 'holding-radio' %>
            </div>
            <div class="panel panel-success">
              <div class="panel-heading" role="tab" id="heading<%= i %>">
                <h5 class="panel-title">
                  <div class="row">
                    <div class="col-md-9">
                      <a class="item-select-button" role="button" data-toggle="collapse" data-parent="#holding-accordion" href="#collapse<%= i %>" aria-expanded="false" aria-controls="collapse<%= i %>" data-mms-id="<%= @record.mms_id %>" data-holding-id="<%= holding.id %>">
                        <%= holding.label %>
                      </a>
                    </div>
                    <div class="col-md-3">
                      <span class="badge pull-right"><%= "#{holding.available_items} #{'item'.pluralize(holding.available_items)} available" %></span>
                    </div>
                  </div>
                </h5>
              </div>
              <div id="collapse<%= i %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading<%= i %>">
                <div class="panel-body item-select-container" style="max-height: 250px; overflow-y: auto;"></div>
              </div>
            </div>
          <% else %>
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="heading<%= i %>">
                <h4 class="panel-title">
                  <%= holding.label %>
                  <span class="badge pull-right">No items available</span>
                </h4>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <p>No holdings - what's up with that?</p>
      <% end %>
    </div>
  <% end %>
</section>