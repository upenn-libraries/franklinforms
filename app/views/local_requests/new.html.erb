<% @page_title = 'Request from Penn Libraries' %>

<div class="well">
  <p>
    There are <%= @holdings.length %> holdings for MMS ID <%= params[:mms_id] %>
  </p>
  <% @holdings.each do |holding| %>
    <p><%= holding %></p>
  <% end %>
  <p>
    User is: <%= pp @user.to_h %>
  </p>
</div>

<h1><%= t('forms.local_request.heading') %></h1>

<%= bootstrap_form_for(@local_request) do |f| %>

  <h2><%= t('forms.local_request.sections.patron') %></h2>
  <div class="row">
    <div class="col-sm-6">
      <%= f.static_control :by, label: t('forms.common.fields.name') do %>
        <%= @user.name %>
      <% end %>
    </div>
    <div class="col-sm-6">
      <%= f.static_control :affiliation, label: t('forms.local_request.fields.affiliation') do %>
        <%= @user.organization %>
      <% end %>
    </div>
  </div>
  <%= f.email_field :email, label: t('forms.common.fields.email'), value: @user.email %>

  <h2>
    Item Information
  </h2>
  <div class="well">
    <% if @item %>
      <p>Item Info</p>
      <%= pp @item.to_json %>
      <% if @item.in_place? && !@item.non_circulating? %>
        <p>Item is [in place and not non-circulating and therefore] available for PickUp or Books by Mail Delivery</p>
      <% else %>
        <p>Item is unavailable. Try <a href="#">Requesting via ILL</a></p>
      <% end %>
    <% elsif @holdings %>
      <p>Select an Item!</p>
    <% else %>
      <p>Oh dear!?</p>
    <% end %>
  </div>

  <h2><%= t('forms.local_request.sections.delivery') %></h2>
  <%= f.select :delivery_method, @delivery_options, label: t('forms.local_request.fields.delivery_method'), prompt: t('forms.ill.messages.delivery_options_blank') %>
  <div class="alert alert-warning">
    <p class="hidden bbm-messages">
      <%= t('forms.local_request.delivery_messages.bbm_html') %>
    </p>
    <p class="hidden pap-messages">
      <%= t('forms.local_request.delivery_messages.pap_html') %>
    </p>
    <p class="hidden digi-messages">
      <%= t('forms.local_request.delivery_messages.digi_html') %>
    </p>
  </div>

  <h2><%= t('forms.local_request.sections.record') %></h2>

  <!-- legacy form stuff -->
  <!--  <h3><%#= request_type_message @local_request.type %></h3>-->
  <%#= request_type_fields @local_request.type, f %>

  <%#= f.text_area :comments, label: t('forms.local_request.fields.comment'), help: t('forms.local_request.messages.comment_limit') %>
  <!-- end legacy -->

  <%= f.submit t('forms.common.fields.submit') %>

<% end %>